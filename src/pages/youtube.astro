---
// Import layout dan komponen
import MainGridLayout from '../layouts/MainGridLayout.astro'
import { i18n } from '../i18n/translation'
import I18nKey from '../i18n/i18nKey'
import { useState } from 'preact/hooks'
import axios from 'axios'

// API Key YouTube Data API
const YOUTUBE_API_KEY = 'AIzaSyALDAm7Ueoh29tGubH4sTcJV70mMAv7JdE'

// State untuk hasil pencarian
const [searchResults, setSearchResults] = useState([])

// Fungsi pencarian video
const searchYouTube = async (query) => {
    if (!query) return;

    const youtubeAPI = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(query)}&key=${YOUTUBE_API_KEY}`;
    
    try {
        const response = await axios.get(youtubeAPI);
        const items = response.data.items;
        setSearchResults(items);
    } catch (error) {
        console.error('Error saat mencari video YouTube:', error);
    }
}

// Tangani pengiriman formulir pencarian
const handleSearch = (event) => {
    event.preventDefault();
    const query = event.target.elements.query.value;
    searchYouTube(query);
}
---
<MainGridLayout title={i18n(I18nKey.search)} description={i18n(I18nKey.searchDescription)}>
    <div class="w-full flex justify-center">
        <form onSubmit={handleSearch} class="flex w-full max-w-4xl">
            <input
                type="text"
                name="query"
                placeholder="Cari video YouTube..."
                class="w-full p-2 border rounded-l"
            />
            <button
                type="submit"
                class="p-2 bg-blue-500 text-white border border-blue-500 rounded-r"
            >
                Cari
            </button>
        </form>
    </div>
    <div class="mt-8">
        {searchResults.length > 0 ? (
            <div class="flex flex-wrap gap-4">
                {searchResults.map((video) => (
                    <div class="w-full md:w-1/2 lg:w-1/3">
                        <div class="card-base">
                            <iframe
                                width="100%"
                                height="180"
                                src={`https://www.youtube.com/embed/${video.id.videoId}`}
                                title={video.snippet.title}
                                frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen
                            ></iframe>
                            <div class="p-4">
                                <h3 class="text-lg font-semibold">{video.snippet.title}</h3>
                                <p class="text-sm text-gray-500">{video.snippet.description}</p>
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        ) : (
            <p>Belum ada hasil pencarian.</p>
        )}
    </div>
</MainGridLayout>
