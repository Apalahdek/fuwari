---
import MainGridLayout from '../layouts/MainGridLayout.astro'
import { useState } from 'preact/hooks'
import axios from 'axios'
import Markdown from '@components/misc/Markdown.astro'

// API Key YouTube Data API
const YOUTUBE_API_KEY = 'AIzaSyALDAm7Ueoh29tGubH4sTcJV70mMAv7JdE'

// State untuk hasil pencarian
const [searchResults, setSearchResults] = useState([])

// Fungsi pencarian video
const searchYouTube = async (query) => {
    if (!query) return;

    const youtubeAPI = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(query)}&key=${YOUTUBE_API_KEY}`;
    
    try {
        const response = await axios.get(youtubeAPI);
        const items = response.data.items;
        setSearchResults(items);
    } catch (error) {
        console.error('Error saat mencari video YouTube:', error);
    }
}

// Tangani pengiriman formulir pencarian
const handleSearch = (event) => {
    event.preventDefault();
    const query = event.target.elements.query.value;
    searchYouTube(query);
}

// Render hasil pencarian
const videoResults = searchResults.map((video) => `
    ## ${video.snippet.title}
    ![Video Thumbnail](https://img.youtube.com/vi/${video.id.videoId}/hqdefault.jpg)
    [Tonton Video](https://www.youtube.com/watch?v=${video.id.videoId})
    \n\n
    ${video.snippet.description}
`).join('\n\n')

const content = `
# Hasil Pencarian Video YouTube

Berikut adalah hasil pencarian untuk video YouTube:

${videoResults}
`

---
<MainGridLayout title="Pencarian Video YouTube" description="Temukan video berdasarkan pencarian Anda">
    <div class="w-full flex justify-center">
        <form onSubmit={handleSearch} class="flex w-full max-w-4xl">
            <input
                type="text"
                name="query"
                placeholder="Cari video YouTube..."
                class="w-full p-2 border rounded-l"
            />
            <button
                type="submit"
                class="p-2 bg-blue-500 text-white border border-blue-500 rounded-r"
            >
                Cari
            </button>
        </form>
    </div>
    <div class="mt-8">
        <Markdown>{content}</Markdown>
    </div>
</MainGridLayout>
